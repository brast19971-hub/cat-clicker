<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫ –ø–æ –ö–æ—Ç–∏–∫—É</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            overflow-y: auto;
            transition: background 0.5s;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
        }
        #cat {
            width: 200px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.2s;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            border-radius: 50%;
            animation: wiggle 2s ease-in-out infinite;
        }
        #cat:hover {
            transform: scale(1.1);
            animation-play-state: paused;
        }
        #cat:active {
            transform: scale(0.95);
        }
        @keyframes wiggle {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        #stats {
            text-align: center;
            margin: 20px 0;
        }
        #counter, #coins, #potions, #level {
            font-size: 1.5em;
            margin: 10px 0;
        }
        #shop {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px;
            gap: 10px;
        }
        .shop-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .shop-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        }
        .shop-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #breed-btn {
            background: linear-gradient(45deg, #9c27b0, #7b1fa2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        #breed-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #7b1fa2, #9c27b0);
        }
        #breed-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #search {
            padding: 10px;
            margin: 10px;
            border-radius: 20px;
            border: none;
            width: 200px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-align: center;
        }
        #search::placeholder {
            color: #ccc;
        }
        #bag {
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 15px;
            max-width: 300px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        #bag h3 {
            margin-top: 0;
            text-align: center;
        }
        .cat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .cat-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .cat-img-small {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            vertical-align: middle;
        }
        .cat-details {
            flex-grow: 1;
            margin-left: 10px;
        }
        .rarity {
            font-size: 0.8em;
            color: #ffd700;
            font-weight: bold;
        }
        .sell-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .sell-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        }
        .empty-bag {
            font-style: italic;
            color: #ccc;
            text-align: center;
        }
        /* –ú–æ–¥–∞–ª */
        #modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        #modal-content {
            background: linear-gradient(to bottom, #333, #555);
            margin: 10% auto;
            padding: 20px;
            border-radius: 20px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }
        #modal-cat-img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: wiggle 2s ease-in-out infinite;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        #modal-attrs {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        #modal-attrs li {
            margin: 5px 0;
            font-size: 0.9em;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        #modal-price {
            font-size: 1.2em;
            color: #ffd700;
            font-weight: bold;
            margin: 10px 0;
        }
        #close-modal, #sell-from-modal, #share-modal {
            margin: 10px;
            padding: 12px 18px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        #close-modal {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        #close-modal:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        #sell-from-modal {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        #sell-from-modal:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        #share-modal {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
        }
        #share-modal:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h1>–ö–ª–∏–∫–∞–π –ø–æ –∫–æ—Ç–∏–∫—É! üê±</h1>
    <img id="cat" src="https://cataas.com/cat?says=Hi" alt="–ö–æ—Ç–∏–∫">
    <div id="stats">
        <div id="level">–£—Ä–æ–≤–µ–Ω—å: 1</div>
        <div id="counter">–ö–ª–∏–∫–æ–≤: 0</div>
        <div id="coins">–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: 0</div>
        <div id="potions">–ó–µ–ª—å—è: 0</div>
        <div id="shop">
            <button class="shop-btn" id="buy-auto">ü§ñ –ê–≤—Ç–æ-–∫–ª–∏–∫ (200 –º–æ–Ω–µ—Ç)</button>
            <button class="shop-btn" id="buy-evo">üåü –≠–≤–æ–ª—é—Ü–∏—è (300 –º–æ–Ω–µ—Ç)</button>
            <button class="shop-btn" id="buy-potion">üß™ –ó–µ–ª—å–µ (50 –º–æ–Ω–µ—Ç)</button>
        </div>
        <br>
        <button id="breed-btn">‚ú® –°–∫—Ä–µ—â–∏–≤–∞—Ç—å –∫–æ—Ç–∏–∫–æ–≤!</button>
    </div>
    <div id="bag">
        <h3>–¢–≤–æ—è —Å—É–º–∫–∞ üëú</h3>
        <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–∏–ø—É...">
        <div id="bag-content">–°—É–º–∫–∞ –ø—É—Å—Ç–∞, –∫–ª–∏–∫–∞–π –¥–∞–ª—å—à–µ!</div>
    </div>

    <!-- –ú–æ–¥–∞–ª -->
    <div id="modal">
        <div id="modal-content">
            <img id="modal-cat-img" src="" alt="–ö–æ—Ç–∏–∫">
            <h3 id="modal-name"></h3>
            <ul id="modal-attrs"></ul>
            <div id="modal-price"></div>
            <button id="share-modal">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            <button id="close-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button id="sell-from-modal">–ü—Ä–æ–¥–∞—Ç—å</button>
        </div>
    </div>

    <script>
        // Telegram init
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            document.body.style.background = Telegram.WebApp.themeParams.bg_color || '#667eea';
        }

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –±–æ–ª—å—à–µ –ø–æ—Ä–æ–¥ –∏ –∏–º—ë–Ω
        const catTypes = [
            { type: '–ü—É—à–∏—Å—Ç–∏–∫', desc: 'Fluffy dream' },
            { type: '–°–∫–æ—Ç—Ç–∏—à', desc: 'Foldy cutie' },
            { type: '–°—Ñ–∏–Ω–∫—Å', desc: 'Bald boss' },
            { type: '–ë–µ–Ω–≥–∞–ª—å—Å–∫–∏–π', desc: 'Wild spark' },
            { type: '–ê–±–∏—Å—Å–∏–Ω—Å–∫–∏–π', desc: 'Tickly tick' },
            { type: '–°–∏–∞–º—Å–∫–∏–π', desc: 'Chatty charm' },
            { type: '–ü–µ—Ä—Å–∏–¥—Å–∫–∏–π', desc: 'Fluffy royal' },
            { type: '–ú–µ–π–Ω –ö—É–Ω', desc: 'Gentle giant' },
            { type: '–†—ç–≥–¥–æ–ª–ª', desc: 'Raggy doll' },
            { type: '–ë–∏—Ä–º–∞–Ω—Å–∫–∏–π', desc: 'Sacred seal' },
            { type: '–û—Ä–∏–µ–Ω—Ç–∞–ª—å–Ω—ã–π', desc: 'Slim sleek' },
            { type: '–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π –®–æ—Ä—Ç—Ö—ç—Ä', desc: 'Everyday hero' },
            { type: '–†—É—Å—Å–∫–∞—è –ì–æ–ª—É–±–∞—è', desc: 'Blue velvet' },
            { type: '–ë–æ–º–±–µ–π—Å–∫–∏–π', desc: 'Panther mini' },
            { type: '–≠–∫–∑–æ—Ç–∏–∫ –®–æ—Ä—Ç—Ö—ç—Ä', desc: 'Persian shorty' },
            { type: '–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–π –®–æ—Ä—Ç—Ö—ç—Ä', desc: 'Teddy bear' },
            { type: '–ë–∏—Ä–º–∞–Ω—Å–∫–∏–π', desc: 'Mystic points' },
            { type: '–®–æ—Ç–ª–∞–Ω–¥—Å–∫–∏–π –§–æ–ª–¥', desc: 'Folded ears' },
            { type: '–ë–∏—Ä–º–∞–Ω—Å–∫–∏–π', desc: 'Sacred seal' },
            { type: '–¢—É—Ä–µ—Ü–∫–∏–π –í–∞–Ω', desc: 'Swimming van' }
        ];
        const rarities = [
            { name: 'common', multiplier: 1, color: '#ccc', basePrice: [5, 15] },
            { name: 'rare', multiplier: 1.2, color: '#00ff00', basePrice: [20, 40] },
            { name: 'epic', multiplier: 1.5, color: '#ffd700', basePrice: [50, 100] }
        ];
        const names = ['–ú—É—Ä–∑–∏–∫', '–ü—É—à–∏—Å—Ç–∏–∫', '–®—Ä—ë–¥–∏–Ω–≥–µ—Ä', '–ë—É—Å—è', '–ö–µ–∫—Å', '–ó–≤—ë–∑–¥–æ—á–∫–∞', '–¢–∏—à–∞', '–ù—è—à–∞', '–§–∏—Ñ–∏', '–õ–∞–ø–∫–∞', '–ì–æ—Ç–∏–∫', '–®—ç–¥–æ—É', '–†–µ–π–≤–µ–Ω', '–ü–æ–∑–∑–∏', '–í–∏—Å–∫–µ—Ä—Å', '–ü–∞–≤–∑–∏–ª–ª–∞', '–ú—É–Ω—à–∞–π–Ω', '–≠–∫–ª–∏–ø—Å', '–§—Ä–æ—Å—Ç', '–ë–ª—ç–π–∑', '–°–∏–ª–≤–µ—Ä', '–í–∞–π–ª–¥', '–°–≤–∏—Ç—á', '–î—Ä–∏–º', '–ù–æ–∫—Ç—é—Ä–Ω', '–ê–ª–±—É—Å', '–§—Ä–µ–∫–∏', '–§–ª–æ—Ä–∞', '–ö–æ–±–∞–ª—å—Ç', '–ì–µ—Ä–º–µ—Å', '–î–∂–µ–π–¥–µ–Ω', '–î—ç—à', '–ö–æ—Ä–∏—Ü–∞', '–î–∂–∞—Ñ—Ñ–∞', '–†—ã—Ü–∞—Ä—å', '–ó–∏–≥–≥–∏', '–ì—É–¥–∏–Ω–∏', '–ë–µ–Ω—Ç–ª–∏', '–ñ–µ–ª–µ', '–î—É—Å—Ç –ë–∞–Ω–Ω–∏', '–§–∞–∑–∑', '–¢–æ—É –î–∂—ç–º', '–ú–∞–∫–Ω–∞–≥–≥–µ—Ç', '–õ–µ—Ç—Ç—É—Å', '–ü–∏–∫–ª', '–¢–≤–∏–¥', '–ê—Å—Ç–µ—Ä–∏—Å–∫', '–ê–º–ø–µ—Ä—Å–∞–Ω–¥', '–î–æ—Ç', '–ü—É–¥–ª', '–°—Ç–æ—É–Ω', '–¢–≤–∏–Ω–∫–∏', '–°–Ω–∏–∫–µ—Ä', '–í–∏–Ω–¥–∏', '–ü–ª–∞–º', '–°–∫–∞—Ç–ª–±–∞—Ç—Ç', '–î–∂–∏–≥–≥–ª–∏–ø–∞—Ñ—Ñ', '–ó—É–∑—É', '–ú–∞—Ä–º–∏—Ç', '–ú–µ–π–¥–∂–æ—Ä –¢–æ–º', '–ú–µ—Ä—Ç–ª', '–†–µ–±–µ–ª', '–ö–∞–∫–∞–æ', '–ê–ª–µ–∫—Å', '–ë–µ–π–ª–∏', '–ë–∏—Å–∫–≤–∏—Ç', '–ë–ª–æ—Å—Å–æ–º', '–ë–µ–ª–ª–∞', '–õ—É–Ω–∞', '–û–ª–∏–≤–µ—Ä', '–õ–µ–æ', '–°–Ω–∏–∫–µ—Ä—Å', '–ú–∞—Ä—à–º–µ–ª–ª–æ—É', '–ó–µ—Ñ–∏—Ä', '–ö–∞–ª–∏–ø—Å–æ', '–ß—ç—Ä–º–µ–Ω', '–≠–±–±–∏', '–ê—Ä—Ç–µ–º–∏–¥–∞', '–ê—Ñ–∏–Ω–∞', '–ë–µ–Ω', '–ë–∞—Å—Ç–µ—Ä', '–•–∞—Ä–ª–∏', '–ì–µ–Ω—Ä–∏', '–•–æ–±–±—Å', '–î–∂–µ–∫—Å–æ–Ω', '–î–∂–µ—Ä—Ä–∏', '–ú—É—Ñ–∞—Å–∞', '–ú–∞—Ñ—Ñ–µ—Ç', '–úuffin', '–ü–∞–Ω–¥–∞', '–ü–∏—á', '–ü–∏–ø', '–¢–∏–Ω–∫–µ—Ä', '–ú–∏–¥–∂', '–ü–∏–Ω–∞—Ç', '–ë–∞—Ç—Ç–æ–Ω', '–ë–∏–Ω–∑', '–ê—Ç—Ç–∏–∫—É—Å', '–ë—Ä–∏–µ–Ω–Ω–∞', '–ë–∞—Ç—Ç–µ—Ä–∫–∞–ø', '–°–µ—Ä—Å–µ—è', '–ß–µ—à–∏—Ä –ö—ç—Ç', '–î–µ–π–Ω–µ—Ä—ã—Å', '–î–∞—Ä—Å–∏', '–ë–∞–≥–µ—Ä–∞', '–†—É—Ñ—É—Å', '–ö–∞—Å–ø–∏–∞–Ω'];

        // –ó–∞–≥—Ä—É–∑–∫–∞
        let clicks = parseInt(localStorage.getItem('catClicks')) || 0;
        let coins = parseInt(localStorage.getItem('catCoins')) || 0;
        let potions = parseInt(localStorage.getItem('catPotions')) || 0;
        let level = parseInt(localStorage.getItem('catLevel')) || 1;
        let autoClick = parseInt(localStorage.getItem('autoClick')) || 0;
        let evolved = localStorage.getItem('evolved') === 'true';
        let inventory = JSON.parse(localStorage.getItem('catInventory')) || [];
        if (inventory.length > 50) inventory = inventory.slice(-50);

        const cat = document.getElementById('cat');
        const counter = document.getElementById('counter');
        const coinsEl = document.getElementById('coins');
        const potionsEl = document.getElementById('potions');
        const levelEl = document.getElementById('level');
        const bagContent = document.getElementById('bag-content');
        const buyPotionBtn = document.getElementById('buy-potion');
        const breedBtn = document.getElementById('breed-btn');
        const buyAuto = document.getElementById('buy-auto');
        const buyEvo = document.getElementById('buy-evo');
        const searchInput = document.getElementById('search');
        const modal = document.getElementById('modal');
        const modalCatImg = document.getElementById('modal-cat-img');
        const modalName = document.getElementById('modal-name');
        const modalAttrs = document.getElementById('modal-attrs');
        const modalPrice = document.getElementById('modal-price');
        const closeModal = document.getElementById('close-modal');
        const sellFromModal = document.getElementById('sell-from-modal');
        const shareModal = document.getElementById('share-modal');
        let currentModalIndex = -1;
        let filteredInventory = [...inventory];

        // –£—Ä–æ–≤–Ω–∏
        function checkLevel() {
            const newLevel = Math.floor(clicks / 500) + 1;
            if (newLevel > level) {
                level = newLevel;
                coins += level * 50;
                if (Telegram.WebApp) Telegram.WebApp.showAlert(`–£—Ä–æ–≤–µ–Ω—å ${level}! +${level * 50} –º–æ–Ω–µ—Ç üéâ`);
                const gradients = [
                    'linear-gradient(to bottom, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(to bottom, #ff6b6b 0%, #ee5a24 100%)',
                    'linear-gradient(to bottom, #a8e6cf 0%, #88d8a3 100%)'
                ];
                document.body.style.background = gradients[(level - 1) % gradients.length];
            }
        }

        // –ê–≤—Ç–æ-–∫–ª–∏–∫
        setInterval(() => {
            if (autoClick > 0) {
                for (let i = 0; i < autoClick; i++) {
                    clicks++;
                    if (clicks % 50 === 0) {
                        const newCat = generateCat();
                        inventory.push(newCat);
                        if (Telegram.WebApp) Telegram.WebApp.showAlert(`${newCat.name} —É–ø–∞–ª –≤ —Å—É–º–∫—É! –†–µ–¥–∫–æ—Å—Ç—å: ${newCat.rarity.toUpperCase()} üòª`);
                    }
                }
                updateUI();
                checkLevel();
            }
        }, 1000);

        // –†–∞–Ω–¥–æ–º–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
        function getCatImage(catData) {
            const hash = catData.name + catData.type + Math.random().toString(36).substring(7);
            return `https://cataas.com/cat?${hash}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (—Ñ–∏–∫—Å –¥–ª—è –¢–ì: force render)
        function updateUI() {
            counter.textContent = `–ö–ª–∏–∫–æ–≤: ${clicks}`;
            coinsEl.textContent = `–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: ${coins}`;
            potionsEl.textContent = `–ó–µ–ª—å—è: ${potions}`;
            levelEl.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${level}`;
            buyPotionBtn.disabled = coins < 50;
            buyAuto.disabled = coins < 200;
            buyEvo.disabled = coins < 300 || evolved;
            breedBtn.disabled = inventory.length < 2 || potions < 1;
            breedBtn.textContent = `‚ú® –°–∫—Ä–µ—â–∏–≤–∞—Ç—å –∫–æ—Ç–∏–∫–æ–≤! (${potions} –∑–µ–ª–∏–π)`;

            filteredInventory = inventory.filter(cat => 
                cat.name.toLowerCase().includes(searchInput.value.toLowerCase()) || 
                cat.type.toLowerCase().includes(searchInput.value.toLowerCase())
            );

            if (filteredInventory.length === 0) {
                bagContent.innerHTML = '<div class="empty-bag">–°—É–º–∫–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!</div>';
            } else {
                bagContent.innerHTML = filteredInventory.map((cat, idx) => {
                    const realIdx = inventory.indexOf(cat);
                    return `
                        <div class="cat-item" onclick="openModal(${realIdx})">
                            <img class="cat-img-small" src="${getCatImage(cat)}" alt="${cat.name}">
                            <div class="cat-details">
                                <div>${cat.name} (${cat.type})</div>
                                <div class="rarity">${cat.rarity.toUpperCase()} ‚Äî ${cat.price} –º–æ–Ω–µ—Ç</div>
                            </div>
                            <button class="sell-btn" onclick="
