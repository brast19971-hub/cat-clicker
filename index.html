<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫ –ø–æ –ö–æ—Ç–∏–∫—É</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            overflow-y: auto;
            transition: background 0.5s;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }
        #cat {
            width: 200px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.2s;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            border-radius: 50%;
            animation: wiggle 2s ease-in-out infinite;
        }
        #cat:hover {
            transform: scale(1.1);
            animation-play-state: paused;
        }
        #cat:active {
            transform: scale(0.95);
        }
        @keyframes wiggle {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        #stats {
            text-align: center;
            margin: 20px 0;
        }
        #counter, #coins, #potions, #level {
            font-size: 1.5em;
            margin: 10px 0;
        }
        #shop {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px;
        }
        .shop-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin: 5px;
        }
        .shop-btn:hover:not(:disabled) {
            background: #f57c00;
        }
        .shop-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #breed-btn {
            background: #9c27b0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
        }
        #breed-btn:hover:not(:disabled) {
            background: #7b1fa2;
        }
        #breed-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #search {
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            border: none;
            width: 200px;
        }
        #bag {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        #bag h3 {
            margin-top: 0;
        }
        .cat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .cat-item:hover {
            background: rgba(255,255,255,0.2);
        }
        .cat-img-small {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            vertical-align: middle;
        }
        .cat-details {
            flex-grow: 1;
            margin-left: 10px;
        }
        .rarity {
            font-size: 0.8em;
            color: #ffd700;
        }
        .sell-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .sell-btn:hover {
            background: #ff5252;
        }
        .empty-bag {
            font-style: italic;
            color: #ccc;
        }
        /* –ú–æ–¥–∞–ª */
        #modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        #modal-content {
            background: linear-gradient(to bottom, #333, #555);
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            color: white;
        }
        #modal-cat-img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: wiggle 2s ease-in-out infinite;
        }
        #modal-attrs {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        #modal-attrs li {
            margin: 5px 0;
            font-size: 0.9em;
        }
        #modal-price {
            font-size: 1.2em;
            color: #ffd700;
        }
        #close-modal, #sell-from-modal, #share-modal {
            margin: 10px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #close-modal {
            background: #ccc;
            color: black;
        }
        #sell-from-modal {
            background: #ff6b6b;
            color: white;
        }
        #share-modal {
            background: #4caf50;
            color: white;
        }
    </style>
</head>
<body>
    <h1>–ö–ª–∏–∫–∞–π –ø–æ –∫–æ—Ç–∏–∫—É! üê±</h1>
    <img id="cat" src="https://cataas.com/cat?says=Hi" alt="–ö–æ—Ç–∏–∫">
    <div id="stats">
        <div id="level">–£—Ä–æ–≤–µ–Ω—å: 1</div>
        <div id="counter">–ö–ª–∏–∫–æ–≤: 0</div>
        <div id="coins">–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: 0</div>
        <div id="potions">–ó–µ–ª—å—è: 0</div>
        <div id="shop">
            <button class="shop-btn" id="buy-auto">–ê–≤—Ç–æ-–∫–ª–∏–∫ (200 –º–æ–Ω–µ—Ç) ü§ñ</button>
            <button class="shop-btn" id="buy-evo">–≠–≤–æ–ª—é—Ü–∏—è (300 –º–æ–Ω–µ—Ç) üåü</button>
            <button class="shop-btn" id="buy-potion">–ó–µ–ª—å–µ (50 –º–æ–Ω–µ—Ç) üß™</button>
        </div>
        <br>
        <button id="breed-btn" disabled>–°–∫—Ä–µ—â–∏–≤–∞—Ç—å –∫–æ—Ç–∏–∫–æ–≤! ‚ú®</button>
    </div>
    <div id="bag">
        <h3>–¢–≤–æ—è —Å—É–º–∫–∞ üëú</h3>
        <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–∏–ø—É..." oninput="filterBag()">
        <div id="bag-content">–°—É–º–∫–∞ –ø—É—Å—Ç–∞, –∫–ª–∏–∫–∞–π –¥–∞–ª—å—à–µ!</div>
    </div>

    <!-- –ú–æ–¥–∞–ª -->
    <div id="modal">
        <div id="modal-content">
            <img id="modal-cat-img" src="" alt="–ö–æ—Ç–∏–∫">
            <h3 id="modal-name"></h3>
            <ul id="modal-attrs"></ul>
            <div id="modal-price"></div>
            <button id="share-modal">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            <button id="close-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button id="sell-from-modal">–ü—Ä–æ–¥–∞—Ç—å</button>
        </div>
    </div>

    <script>
        // Telegram init
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            document.body.style.background = Telegram.WebApp.themeParams.bg_color || '#667eea';
        }

        // –î–∞–Ω–Ω—ã–µ (—É–ø—Ä–æ—Å—Ç–∏–ª –∞—Ç—Ä–∏–±—É—Ç—ã, —Ñ–æ–∫—É—Å –Ω–∞ —Ç–∏–ø–∞—Ö –∏ —Ä–µ–¥–∫–æ—Å—Ç–∏)
        const catTypes = [
            { type: '–ü—É—à–∏—Å—Ç–∏–∫', desc: 'Fluffy dream' },
            { type: '–°–∫–æ—Ç—Ç–∏—à', desc: 'Foldy cutie' },
            { type: '–°—Ñ–∏–Ω–∫—Å', desc: 'Bald boss' },
            { type: '–ë–µ–Ω–≥–∞–ª—å—Å–∫–∏–π', desc: 'Wild spark' },
            { type: '–ê–±–∏—Å—Å–∏–Ω—Å–∫–∏–π', desc: 'Tickly tick' },
            { type: '–°–∏–∞–º—Å–∫–∏–π', desc: 'Chatty charm' }
        ];
        const rarities = [
            { name: 'common', multiplier: 1, color: '#ccc' },
            { name: 'rare', multiplier: 1.2, color: '#00ff00' },
            { name: 'epic', multiplier: 1.5, color: '#ffd700' }
        ];
        const names = ['–ú—É—Ä–∑–∏–∫', '–ü—É—à–∏—Å—Ç–∏–∫', '–®—Ä—ë–¥–∏–Ω–≥–µ—Ä', '–ë—É—Å—è', '–ö–µ–∫—Å', '–ó–≤—ë–∑–¥–æ—á–∫–∞', '–¢–∏—à–∞', '–ù—è—à–∞', '–§–∏—Ñ–∏', '–õ–∞–ø–∫–∞', '–ì–æ—Ç–∏–∫', '–®—ç–¥–æ—É', '–†–µ–π–≤–µ–Ω', '–ü–æ–∑–∑–∏', '–í–∏—Å–∫–µ—Ä—Å', '–ü–∞–≤–∑–∏–ª–ª–∞', '–ú—É–Ω—à–∞–π–Ω', '–≠–∫–ª–∏–ø—Å', '–§—Ä–æ—Å—Ç', '–ë–ª—ç–π–∑', '–°–∏–ª–≤–µ—Ä', '–í–∞–π–ª–¥', '–°–≤–∏—Ç—á', '–î—Ä–∏–º', '–ù–æ–∫—Ç—é—Ä–Ω'];

        // –ó–∞–≥—Ä—É–∑–∫–∞
        let clicks = parseInt(localStorage.getItem('catClicks')) || 0;
        let coins = parseInt(localStorage.getItem('catCoins')) || 0;
        let potions = parseInt(localStorage.getItem('catPotions')) || 0;
        let level = parseInt(localStorage.getItem('catLevel')) || 1;
        let autoClick = parseInt(localStorage.getItem('autoClick')) || 0;
        let evolved = localStorage.getItem('evolved') === 'true';
        let inventory = JSON.parse(localStorage.getItem('catInventory')) || [];
        if (inventory.length > 50) inventory = inventory.slice(-50);

        const cat = document.getElementById('cat');
        const counter = document.getElementById('counter');
        const coinsEl = document.getElementById('coins');
        const potionsEl = document.getElementById('potions');
        const levelEl = document.getElementById('level');
        const bagContent = document.getElementById('bag-content');
        const buyPotionBtn = document.getElementById('buy-potion');
        const breedBtn = document.getElementById('breed-btn');
        const buyAuto = document.getElementById('buy-auto');
        const buyEvo = document.getElementById('buy-evo');
        const searchInput = document.getElementById('search');
        const modal = document.getElementById('modal');
        const modalCatImg = document.getElementById('modal-cat-img');
        const modalName = document.getElementById('modal-name');
        const modalAttrs = document.getElementById('modal-attrs');
        const modalPrice = document.getElementById('modal-price');
        const closeModal = document.getElementById('close-modal');
        const sellFromModal = document.getElementById('sell-from-modal');
        const shareModal = document.getElementById('share-modal');
        let currentModalIndex = -1;
        let filteredInventory = [...inventory];

        // –£—Ä–æ–≤–Ω–∏
        function checkLevel() {
            const newLevel = Math.floor(clicks / 500) + 1;
            if (newLevel > level) {
                level = newLevel;
                coins += level * 50;
                if (Telegram.WebApp) Telegram.WebApp.showAlert(`–£—Ä–æ–≤–µ–Ω—å ${level}! +${level * 50} –º–æ–Ω–µ—Ç üéâ`);
                const gradients = [
                    'linear-gradient(to bottom, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(to bottom, #ff6b6b 0%, #ee5a24 100%)',
                    'linear-gradient(to bottom, #a8e6cf 0%, #88d8a3 100%)'
                ];
                document.body.style.background = gradients[(level - 1) % gradients.length];
            }
        }

        // –ê–≤—Ç–æ-–∫–ª–∏–∫
        setInterval(() => {
            if (autoClick > 0) {
                for (let i = 0; i < autoClick; i++) clicks++;
                updateUI();
                checkLevel();
            }
        }, 1000);

        // –†–∞–Ω–¥–æ–º–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–æ—Ç–∏–∫–∞
        function getCatImage(catData) {
            const hash = catData.name + catData.type + Math.random().toString(36).substring(7);
            return `https://cataas.com/cat?${hash}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            counter.textContent = `–ö–ª–∏–∫–æ–≤: ${clicks}`;
            coinsEl.textContent = `–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: ${coins}`;
            potionsEl.textContent = `–ó–µ–ª—å—è: ${potions}`;
            levelEl.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${level}`;
            buyPotionBtn.disabled = coins < 50;
            buyAuto.disabled = coins < 200;
            buyEvo.disabled = coins < 300 || evolved;
            breedBtn.disabled = inventory.length < 2 || potions < 1;

            filteredInventory = inventory.filter(cat => 
                cat.name.toLowerCase().includes(searchInput.value.toLowerCase()) || 
                cat.type.toLowerCase().includes(searchInput.value.toLowerCase())
            );

            if (filteredInventory.length === 0) {
                bagContent.innerHTML = '<div class="empty-bag">–°—É–º–∫–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!</div>';
            } else {
                bagContent.innerHTML = filteredInventory.map((cat, idx) => {
                    const realIdx = inventory.indexOf(cat);
                    return `
                        <div class="cat-item" onclick="openModal(${realIdx})">
                            <img class="cat-img-small" src="${getCatImage(cat)}" alt="${cat.name}">
                            <div class="cat-details">
                                <div>${cat.name} (${cat.type})</div>
                                <div class="rarity">${cat.rarity.toUpperCase()} ‚Äî ${cat.price} –º–æ–Ω–µ—Ç</div>
                            </div>
                            <button class="sell-btn" onclick="event.stopPropagation(); sellCat(${realIdx})">–ü—Ä–æ–¥–∞—Ç—å</button>
                        </div>
                    `;
                }).join('');
            }
            localStorage.setItem('catClicks', clicks);
            localStorage.setItem('catCoins', coins);
            localStorage.setItem('catPotions', potions);
            localStorage.setItem('catLevel', level);
            localStorage.setItem('autoClick', autoClick);
            localStorage.setItem('evolved', evolved);
            localStorage.setItem('catInventory', JSON.stringify(inventory));

            // –¢–µ–∫—É—â–∏–π –∫–æ—Ç–∏–∫
            const currentCat = generateCat();
            cat.src = getCatImage(currentCat);
            cat.alt = currentCat.name;
        }

        function filterBag() {
            updateUI();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ç–∏–∫–∞ (—É–ø—Ä–æ—Å—Ç–∏–ª)
        function generateCat(parent1 = null, parent2 = null) {
            let type, rarity, price;
            if (parent1 && parent2) {
                type = Math.random() > 0.5 ? parent1.type : parent2.type;
                const rareChance = (parent1.rarity === 'rare' || parent2.rarity === 'rare') ? 0.4 : 0.05;
                rarity = Math.random() < rareChance ? (Math.random() < 0.2 ? 'epic' : 'rare') : 'common';
                price = Math.floor(((parent1.price + parent2.price) / 2) * rarities.find(r => r.name === rarity).multiplier + Math.random() * 10);
            } else {
                const baseIdx = Math.floor(Math.random() * catTypes.length);
                type = catTypes[baseIdx].type;
                const rand = Math.random();
                rarity = rand < 0.05 ? 'epic' : (rand < 0.3 ? 'rare' : 'common');
                price = Math.floor((Math.random() * 40 + 10) * rarities.find(r => r.name === rarity).multiplier);
            }
            const name = names[Math.floor(Math.random() * names.length)];
            return { name, type, rarity, price };
        }

        // –ú–æ–¥–∞–ª
        window.openModal = function(index) {
            currentModalIndex = index;
            const cat = inventory[index];
            modalCatImg.src = getCatImage(cat);
            modalCatImg.alt = cat.name;
            modalName.textContent = `${cat.name} (${cat.type})`;
            modalAttrs.innerHTML = `
                <li>–¢–∏–ø: ${cat.type}</li>
                <li>–†–µ–¥–∫–æ—Å—Ç—å: ${cat.rarity.toUpperCase()}</li>
            `;
            modalPrice.textContent = `–¶–µ–Ω–∞: ${cat.price} –º–æ–Ω–µ—Ç`;
            shareModal.onclick = () => {
                if (Telegram.WebApp) Telegram.WebApp.shareUrl(Telegram.WebApp.initDataUnsafe.start_app_url, `${cat.name} ‚Äî –º–æ–π —Ä–µ–¥–∫–∏–π –∫–æ—Ç–∏–∫! ${cat.rarity.toUpperCase()}`);
            };
            sellFromModal.onclick = () => sellCat(index);
            modal.style.display = 'block';
        };

        closeModal.onclick = () => { modal.style.display = 'none'; };
        window.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };

        // –ü—Ä–æ–¥–∞—Ç—å
        window.sellCat = function(index) {
            const cat = inventory.splice(index, 1)[0];
            coins += cat.price;
            updateUI();
            if (modal.style.display === 'block') modal.style.display = 'none';
            alertOrShow(`–ü—Ä–æ–¥–∞–ª ${cat.name} –∑–∞ ${cat.price} –º–æ–Ω–µ—Ç! üí∞`);
        };

        // –ú–∞–≥–∞–∑–∏–Ω (—É–±—Ä–∞–ª x2)
        buyPotionBtn.addEventListener('click', () => {
            if (coins >= 50) { coins -= 50; potions++; updateUI(); alertOrShow('–ó–µ–ª—å–µ –∫—É–ø–ª–µ–Ω–æ!'); }
        });
        buyAuto.addEventListener('click', () => {
            if (coins >= 200) { coins -= 200; autoClick += 1; updateUI(); alertOrShow('–ê–≤—Ç–æ-–∫–ª–∏–∫ +1/sec!'); }
        });
        buyEvo.addEventListener('click', () => {
            if (coins >= 300 && !evolved) { coins -= 300; evolved = true; cat.style.filter = 'drop-shadow(0 0 20px #ffd700)'; updateUI(); alertOrShow('–≠–≤–æ–ª—é—Ü–∏—è! –ö–æ—Ç–∏–∫ —Å–∏—è–µ—Ç üåü'); }
        });

        // –°–∫—Ä–µ—â–∏–≤–∞–Ω–∏–µ
        breedBtn.addEventListener('click', () => {
            if (inventory.length >= 2 && potions >= 1) {
                const idx1 = Math.floor(Math.random() * inventory.length);
                const idx2 = (idx1 + 1 + Math.floor(Math.random() * (inventory.length - 1))) % inventory.length;
                const parent1 = inventory[idx1];
                const parent2 = inventory[idx2];
                const newCat = generateCat(parent1, parent2);
                inventory.push(newCat);
                potions--;
                updateUI();
                alertOrShow(`–°–∫—Ä–µ—Å—Ç–∏–ª ${parent1.name} –∏ ${parent2.name}! –ü–æ–ª—É—á–∏–ª ${newCat.name} ‚ú®`);
            }
        });

        function alertOrShow(msg) {
            if (Telegram.WebApp) Telegram.WebApp.showAlert(msg); else alert(msg);
        }

        // –ö–ª–∏–∫ (–±–µ–∑ x2)
        cat.addEventListener('click', () => {
            clicks++;
            updateUI();
            checkLevel();
            cat.style.transform = 'scale(1.2)';
            setTimeout(() => { cat.style.transform = 'scale(1)'; }, 150);

            if (clicks % 50 === 0) {
                const newCat = generateCat();
                inventory.push(newCat);
                updateUI();
                alertOrShow(`${newCat.name} —É–ø–∞–ª –≤ —Å—É–º–∫—É! –†–µ–¥–∫–æ—Å—Ç—å: ${newCat.rarity.toUpperCase()} üòª`);
            }

            if (clicks % 10 === 0 && clicks % 50 !== 0) {
                alertOrShow(`–í–∞—É, ${clicks} –∫–ª–∏–∫–æ–≤! üêæ`);
            }
        });

        updateUI();
    </script>
</body>
</html>
