<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫ –ø–æ –ö–æ—Ç–∏–∫—É</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }
        #cat {
            width: 200px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.2s;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        #cat:hover {
            transform: scale(1.1);
        }
        #cat:active {
            transform: scale(0.95);
        }
        #stats {
            text-align: center;
            margin: 20px 0;
        }
        #counter, #coins, #potions {
            font-size: 1.5em;
            margin: 10px 0;
        }
        #buy-potion, #breed-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
        }
        #breed-btn {
            background: #9c27b0;
        }
        #buy-potion:hover, #breed-btn:hover:not(:disabled) {
            opacity: 0.9;
        }
        #buy-potion:disabled, #breed-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #bag {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        #bag h3 {
            margin-top: 0;
        }
        .cat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .cat-item:hover {
            background: rgba(255,255,255,0.2);
        }
        .cat-svg-small {
            width: 30px;
            height: 30px;
            vertical-align: middle;
        }
        .cat-details {
            flex-grow: 1;
            margin-left: 10px;
        }
        .rarity {
            font-size: 0.8em;
            color: #ffd700; /* –ó–æ–ª–æ—Ç–æ–π –¥–ª—è —Ä–µ–¥–∫–æ—Å—Ç–∏ */
        }
        .sell-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .sell-btn:hover {
            background: #ff5252;
        }
        .empty-bag {
            font-style: italic;
            color: #ccc;
        }
        /* –ú–æ–¥–∞–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
        #modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        #modal-content {
            background: linear-gradient(to bottom, #333, #555);
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            color: white;
        }
        #modal-cat-svg {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
        }
        #modal-attrs {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        #modal-attrs li {
            margin: 5px 0;
            font-size: 0.9em;
        }
        #close-modal, #sell-from-modal {
            margin: 10px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #close-modal {
            background: #ccc;
            color: black;
        }
        #sell-from-modal {
            background: #ff6b6b;
            color: white;
        }
    </style>
</head>
<body>
    <h1>–ö–ª–∏–∫–∞–π –ø–æ –∫–æ—Ç–∏–∫—É! üê±</h1>
    <svg id="cat" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π -->
    </svg>
    <div id="stats">
        <div id="counter">–ö–ª–∏–∫–æ–≤: 0</div>
        <div id="coins">–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: 0</div>
        <div id="potions">–ó–µ–ª—å—è: 0</div>
        <button id="buy-potion">–ö—É–ø–∏—Ç—å –∑–µ–ª—å–µ (50 –º–æ–Ω–µ—Ç) üß™</button>
        <br>
        <button id="breed-btn" disabled>–°–∫—Ä–µ—â–∏–≤–∞—Ç—å –∫–æ—Ç–∏–∫–æ–≤! ‚ú®</button>
    </div>
    <div id="bag">
        <h3>–¢–≤–æ—è —Å—É–º–∫–∞ üëú</h3>
        <div id="bag-content">–°—É–º–∫–∞ –ø—É—Å—Ç–∞, –∫–ª–∏–∫–∞–π –¥–∞–ª—å—à–µ!</div>
    </div>

    <!-- –ú–æ–¥–∞–ª -->
    <div id="modal">
        <div id="modal-content">
            <svg id="modal-cat-svg" viewBox="0 0 100 100"></svg>
            <h3 id="modal-name"></h3>
            <ul id="modal-attrs"></ul>
            <div id="modal-price"></div>
            <button id="close-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button id="sell-from-modal">–ü—Ä–æ–¥–∞—Ç—å</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            document.body.style.background = Telegram.WebApp.themeParams.bg_color || '#667eea';
        }

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        const catBases = [
            { type: '–ü—É—à–∏—Å—Ç–∏–∫', baseColor: '#ffdbac' },
            { type: '–°–∫–æ—Ç—Ç–∏—à', baseColor: '#e0c3fc' },
            { type: '–°—Ñ–∏–Ω–∫—Å', baseColor: '#f4a460' },
            { type: '–ë–µ–Ω–≥–∞–ª—å—Å–∫–∏–π', baseColor: '#d2691e' }
        ];
        const patterns = [
            { name: 'solid', desc: '–ì–ª–∞–¥–∫–∏–π' },
            { name: 'striped', desc: '–ü–æ–ª–æ—Å–∞—Ç—ã–π', path: 'M0 0 L10 10 M10 0 L0 10' },
            { name: 'spotted', desc: '–ü—è—Ç–Ω–∏—Å—Ç—ã–π', circles: true },
            { name: 'tabby', desc: '–ú—Ä–∞–º–æ—Ä–Ω—ã–π', swirls: true }
        ];
        const eyeColors = ['green', '#00ff00', 'blue', '#0000ff', 'gold', '#ffd700', 'red', '#ff0000'];
        const furLengths = ['short', 'fluffy', 'bald'];
        const accessories = [
            { name: 'none', desc: '' },
            { name: 'bandana', desc: '–ü–æ–≤—è–∑–∫–∞', path: '<path d="M20 70 Q50 60 80 70" stroke="red" stroke-width="2" fill="none"/>' },
            { name: 'necklace', desc: '–û–∂–µ—Ä–µ–ª—å–µ', path: '<circle cx="50" cy="65" r="5" fill="gold"/>' },
            { name: 'hat', desc: '–®–ª—è–ø–∞', path: '<path d="M30 25 L50 15 L70 25 Z" fill="black"/>' }
        ];
        const rarities = [
            { name: 'common', multiplier: 1, color: '#ccc' },
            { name: 'rare', multiplier: 1.2, color: '#00ff00' },
            { name: 'epic', multiplier: 1.5, color: '#ffd700' }
        ];
        const names = ['–ú—É—Ä–∑–∏–∫', '–ü—É—à–∏—Å—Ç–∏–∫', '–®—Ä—ë–¥–∏–Ω–≥–µ—Ä', '–ë—É—Å—è', '–ö–µ–∫—Å', '–ó–≤—ë–∑–¥–æ—á–∫–∞', '–¢–∏—à–∞', '–ù—è—à–∞', '–§–∏—Ñ–∏', '–õ–∞–ø–∫–∞', '–ì–æ—Ç–∏–∫', '–®—ç–¥–æ—É'];

        // –ó–∞–≥—Ä—É–∑–∫–∞
        let clicks = parseInt(localStorage.getItem('catClicks')) || 0;
        let coins = parseInt(localStorage.getItem('catCoins')) || 0;
        let potions = parseInt(localStorage.getItem('catPotions')) || 0;
        let inventory = JSON.parse(localStorage.getItem('catInventory')) || [];
        if (inventory.length > 20) {
            // –ê–≤—Ç–æ-–ø—Ä–æ–¥–∞–∂–∞ —Å—Ç–∞—Ä—ã—Ö common
            inventory = inventory.slice(-20).filter(cat => cat.rarity !== 'common' || Math.random() > 0.5);
            // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã –æ—Ç –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö, –Ω–æ –ø—Ä–æ—Å—Ç–æ, –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π
        }

        const cat = document.getElementById('cat');
        const counter = document.getElementById('counter');
        const coinsEl = document.getElementById('coins');
        const potionsEl = document.getElementById('potions');
        const bagContent = document.getElementById('bag-content');
        const buyPotionBtn = document.getElementById('buy-potion');
        const breedBtn = document.getElementById('breed-btn');
        const modal = document.getElementById('modal');
        const modalCatSvg = document.getElementById('modal-cat-svg');
        const modalName = document.getElementById('modal-name');
        const modalAttrs = document.getElementById('modal-attrs');
        const modalPrice = document.getElementById('modal-price');
        const closeModal = document.getElementById('close-modal');
        const sellFromModal = document.getElementById('sell-from-modal');
        let currentModalIndex = -1;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SVG —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
        function generateCatSVG(catData, size = 'small') {
            const base = catBases.find(b => b.type === catData.type);
            const pat = patterns.find(p => p.name === catData.pattern);
            const eyeColor = eyeColors[catData.eyeIndex % eyeColors.length];
            const acc = accessories.find(a => a.name === catData.accessory);
            const rarity = rarities.find(r => r.name === catData.rarity);
            const scale = (Math.random() * 1.5 + 0.5).toFixed(2); // –ú–∞—Å—à—Ç–∞–± —Ç–µ–∫—Å—Ç—É—Ä 0.5-2
            let svg = `<defs>
                <pattern id="tex${Math.random()}" x="0" y="0" width="${10 * scale}" height="${10 * scale}" patternUnits="userSpaceOnUse">
                    <rect width="${10 * scale}" height="${10 * scale}" fill="${base.baseColor}"/>
                    ${pat.name === 'striped' ? `<path d="${pat.path}" stroke="#333" stroke-width="${1 * scale}" opacity="0.5"/>` : ''}
                    ${pat.name === 'spotted' ? `<circle cx="${2 * scale}" cy="${2 * scale}" r="${1 * scale}" fill="#333" opacity="0.5"/><circle cx="${8 * scale}" cy="${8 * scale}" r="${1.5 * scale}" fill="#333" opacity="0.5"/>` : ''}
                    ${pat.name === 'tabby' ? `<circle cx="${5 * scale}" cy="${5 * scale}" r="${3 * scale}" fill="none" stroke="#333" stroke-width="${0.5 * scale}" opacity="0.3"/>` : ''}
                </pattern>
            </defs>
            <circle cx="50" cy="50" r="30" fill="url(#tex${Math.random()})" stroke="#333" stroke-width="2" filter="${catData.fur === 'fluffy' ? 'url(#blur)' : ''}"/>`; // Fluffy —Å –±–ª—é—Ä–æ–º, –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–º defs
            svg += `<circle cx="35" cy="45" r="3" fill="${eyeColor}"/><circle cx="65" cy="45" r="3" fill="${eyeColor}"/>`;
            svg += `<circle cx="50" cy="55" r="4" fill="pink"/>`;
            svg += `<path d="M45 60 Q50 65 55 60" stroke="black" stroke-width="2" fill="none"/>`;
            svg += `<path d="M30 30 L25 20 L35 25 Z" fill="${base.baseColor}" stroke="#333" stroke-width="2"/>`;
            svg += `<path d="M70 30 L75 20 L65 25 Z" fill="${base.baseColor}" stroke="#333" stroke-width="2"/>`;
            svg += `<path d="M80 70 Q90 80 85 90" stroke="${base.baseColor}" stroke-width="4" fill="none" stroke-linecap="round"/>`;
            if (acc.name !== 'none') svg += acc.path;
            svg += `<text x="50" y="95" text-anchor="middle" fill="${rarity.color}" font-size="8">‚òÖ ${catData.rarity.toUpperCase()}</text>`;
            return svg;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            counter.textContent = `–ö–ª–∏–∫–æ–≤: ${clicks}`;
            coinsEl.textContent = `–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: ${coins}`;
            potionsEl.textContent = `–ó–µ–ª—å—è: ${potions}`;
            buyPotionBtn.disabled = coins < 50;
            breedBtn.disabled = inventory.length < 2 || potions < 1;

            if (inventory.length === 0) {
                bagContent.innerHTML = '<div class="empty-bag">–°—É–º–∫–∞ –ø—É—Å—Ç–∞, –∫–ª–∏–∫–∞–π –¥–∞–ª—å—à–µ!</div>';
            } else {
                bagContent.innerHTML = inventory.map((cat, index) => `
                    <div class="cat-item" onclick="openModal(${index})">
                        <svg class="cat-svg-small" viewBox="0 0 100 100">${generateCatSVG(cat, 'small')}</svg>
                        <div class="cat-details">
                            <div>${cat.name} (${cat.type}, ${patterns.find(p => p.name === cat.pattern).desc})</div>
                            <div class="rarity">${cat.rarity.toUpperCase()} ‚Äî ${cat.price} –º–æ–Ω–µ—Ç</div>
                        </div>
                        <button class="sell-btn" onclick="event.stopPropagation(); sellCat(${index})">–ü—Ä–æ–¥–∞—Ç—å</button>
                    </div>
                `).join('');
            }
            localStorage.setItem('catClicks', clicks);
            localStorage.setItem('catCoins', coins);
            localStorage.setItem('catPotions', potions);
            localStorage.setItem('catInventory', JSON.stringify(inventory));

            // –¢–µ–∫—É—â–∏–π –∫–æ—Ç–∏–∫ —Ä–∞–Ω–¥–æ–º–Ω—ã–π
            const currentCat = generateCat();
            cat.innerHTML = generateCatSVG(currentCat);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ç–∏–∫–∞ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
        function generateCat(parent1 = null, parent2 = null) {
            let type, pattern, eyeIndex, fur, accessory, rarity, price;
            if (parent1 && parent2) {
                type = Math.random() > 0.5 ? parent1.type : parent2.type;
                pattern = Math.random() > 0.5 ? parent1.pattern : parent2.pattern;
                eyeIndex = Math.floor(Math.random() * eyeColors.length);
                fur = Math.random() > 0.5 ? parent1.fur : parent2.fur;
                accessory = Math.random() > 0.5 ? parent1.accessory : parent2.accessory;
                const rareChance = (parent1.rarity === 'rare' || parent2.rarity === 'rare') ? 0.4 : 0.05;
                rarity = Math.random() < rareChance ? (Math.random() < 0.2 ? 'epic' : 'rare') : 'common';
                price = Math.floor(((parent1.price + parent2.price) / 2) * rarities.find(r => r.name === rarity).multiplier + Math.random() * 10);
            } else {
                const base = catBases[Math.floor(Math.random() * catBases.length)];
                type = base.type;
                pattern = patterns[Math.floor(Math.random() * patterns.length)].name;
                eyeIndex = Math.floor(Math.random() * eyeColors.length);
                fur = furLengths[Math.floor(Math.random() * furLengths.length)];
                accessory = accessories[Math.floor(Math.random() * accessories.length)].name;
                const rand = Math.random();
                rarity = rand < 0.05 ? 'epic' : (rand < 0.3 ? 'rare' : 'common');
                price = Math.floor((Math.random() * 40 + 10) * rarities.find(r => r.name === rarity).multiplier);
            }
            const name = names[Math.floor(Math.random() * names.length)];
            return { name, type, pattern, eyeIndex, fur, accessory, rarity, price };
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª
        window.openModal = function(index) {
            currentModalIndex = index;
            const cat = inventory[index];
            modalCatSvg.innerHTML = generateCatSVG(cat);
            modalName.textContent = `${cat.name} (${cat.type})`;
            modalAttrs.innerHTML = `
                <li>–£–∑–æ—Ä: ${patterns.find(p => p.name === cat.pattern).desc}</li>
                <li>–ì–ª–∞–∑–∞: ${cat.eyeIndex === 0 ? '–ó–µ–ª—ë–Ω—ã–µ' : cat.eyeIndex === 1 ? '–°–∏–Ω–∏–µ' : cat.eyeIndex === 2 ? '–ó–æ–ª–æ—Ç—ã–µ' : '–ö—Ä–∞—Å–Ω—ã–µ'}</li>
                <li>–®–µ—Ä—Å—Ç—å: ${cat.fur === 'short' ? '–ö–æ—Ä–æ—Ç–∫–∞—è' : cat.fur === 'fluffy' ? '–ü—É—à–∏—Å—Ç–∞—è' : '–ì–æ–ª–∞—è'}</li>
                <li>–ê–∫—Å–µ—Å—Å—É–∞—Ä: ${accessories.find(a => a.name === cat.accessory).desc || '–ù–µ—Ç'}</li>
                <li>–†–µ–¥–∫–æ—Å—Ç—å: ${cat.rarity.toUpperCase()}</li>
            `;
            modalPrice.textContent = `–¶–µ–Ω–∞: ${cat.price} –º–æ–Ω–µ—Ç`;
            sellFromModal.onclick = () => sellCat(index);
            modal.style.display = 'block';
        };

        closeModal.onclick = () => { modal.style.display = 'none'; };
        window.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };

        // –ü—Ä–æ–¥–∞—Ç—å
        window.sellCat = function(index) {
            const cat = inventory.splice(index, 1)[0];
            coins += cat.price;
            updateUI();
            if (modal.style.display === 'block') modal.style.display = 'none';
            alertOrShow(`–ü—Ä–æ–¥–∞–ª ${cat.name} –∑–∞ ${cat.price} –º–æ–Ω–µ—Ç! üí∞`);
        };

        // –ö—É–ø–∏—Ç—å –∑–µ–ª—å–µ
        buyPotionBtn.addEventListener('click', () => {
            if (coins >= 50) {
                coins -= 50;
                potions++;
                updateUI();
                alertOrShow('–ó–µ–ª—å–µ –∫—É–ø–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å —Å–∫—Ä–µ—â–∏–≤–∞–π üòà');
            }
        });

        // –°–∫—Ä–µ—â–∏–≤–∞–Ω–∏–µ
        breedBtn.addEventListener('click', () => {
            if (inventory.length >= 2 && potions >= 1) {
                const idx1 = Math.floor(Math.random() * inventory.length);
                const idx2 = (idx1 + 1 + Math.floor(Math.random() * (inventory.length - 1))) % inventory.length;
                const parent1 = inventory[idx1];
                const parent2 = inventory[idx2];
                const newCat = generateCat(parent1, parent2);
                inventory.push(newCat);
                potions--;
                updateUI();
                alertOrShow(`–°–∫—Ä–µ—Å—Ç–∏–ª ${parent1.name} –∏ ${parent2.name}! –ü–æ–ª—É—á–∏–ª ${newCat.name} ‚ú®`);
            }
        });

        function alertOrShow(msg) {
            if (Telegram.WebApp) {
                Telegram.WebApp.showAlert(msg);
            } else {
                alert(msg);
            }
        }

        // –ö–ª–∏–∫
        cat.addEventListener('click', () => {
            clicks++;
            updateUI();
            cat.style.transform = 'scale(1.2)';
            setTimeout(() => { cat.style.transform = 'scale(1)'; }, 150);

            if (clicks % 50 === 0) {
                const newCat = generateCat();
                inventory.push(newCat);
                updateUI();
                alertOrShow(`${newCat.name} —É–ø–∞–ª –≤ —Å—É–º–∫—É! –†–µ–¥–∫–æ—Å—Ç—å: ${newCat.rarity.toUpperCase()} üòª`);
            }

            if (clicks % 10 === 0 && clicks % 50 !== 0) {
                alertOrShow(`–í–∞—É, ${clicks} –∫–ª–∏–∫–æ–≤! üêæ`);
            }
        });

        updateUI();
    </script>
</body>
</html>
