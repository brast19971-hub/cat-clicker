<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫ –ø–æ –ö–æ—Ç–∏–∫—É</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }
        #cat {
            width: 200px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.2s;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        #cat:hover {
            transform: scale(1.1);
        }
        #cat:active {
            transform: scale(0.95);
        }
        #stats {
            text-align: center;
            margin: 20px 0;
        }
        #counter, #coins, #potions {
            font-size: 1.5em;
            margin: 10px 0;
        }
        #buy-potion {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
        }
        #buy-potion:hover {
            background: #45a049;
        }
        #buy-potion:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #breed-btn {
            background: #9c27b0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
        }
        #breed-btn:hover:not(:disabled) {
            background: #7b1fa2;
        }
        #breed-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #bag {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        #bag h3 {
            margin-top: 0;
        }
        .cat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        .cat-svg {
            width: 30px;
            height: 30px;
            vertical-align: middle;
        }
        .sell-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .sell-btn:hover {
            background: #ff5252;
        }
        .empty-bag {
            font-style: italic;
            color: #ccc;
        }
    </style>
</head>
<body>
    <h1>–ö–ª–∏–∫–∞–π –ø–æ –∫–æ—Ç–∏–∫—É! üê±</h1>
    <svg id="cat" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <!-- –ë–∞–∑–æ–≤—ã–π –∫–æ—Ç–∏–∫, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </svg>
    <div id="stats">
        <div id="counter">–ö–ª–∏–∫–æ–≤: 0</div>
        <div id="coins">–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: 0</div>
        <div id="potions">–ó–µ–ª—å—è: 0</div>
        <button id="buy-potion">–ö—É–ø–∏—Ç—å –∑–µ–ª—å–µ (50 –º–æ–Ω–µ—Ç) üß™</button>
        <br>
        <button id="breed-btn" disabled>–°–∫—Ä–µ—â–∏–≤–∞—Ç—å –∫–æ—Ç–∏–∫–æ–≤! ‚ú®</button>
    </div>
    <div id="bag">
        <h3>–¢–≤–æ—è —Å—É–º–∫–∞ üëú</h3>
        <div id="bag-content">–°—É–º–∫–∞ –ø—É—Å—Ç–∞, –∫–ª–∏–∫–∞–π –¥–∞–ª—å—à–µ!</div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            document.body.style.background = Telegram.WebApp.themeParams.bg_color || '#667eea';
        }

        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ—Ç–∏–∫–æ–≤: —Ç–∏–ø—ã, —Ü–≤–µ—Ç–∞, —É–∑–æ—Ä—ã
        const catBases = [
            { type: '–ü—É—à–∏—Å—Ç–∏–∫', baseColor: '#ffdbac' },
            { type: '–°–∫–æ—Ç—Ç–∏—à', baseColor: '#e0c3fc' },
            { type: '–°—Ñ–∏–Ω–∫—Å', baseColor: '#f4a460' },
            { type: '–ë–µ–Ω–≥–∞–ª—å—Å–∫–∏–π', baseColor: '#d2691e' }
        ];
        const patterns = [
            { name: 'solid', desc: '–ì–ª–∞–¥–∫–∏–π' },
            { name: 'striped', desc: '–ü–æ–ª–æ—Å–∞—Ç—ã–π', path: 'M0 0 L10 10 M10 0 L0 10' }, // –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–æ—Å–∫–∏
            { name: 'spotted', desc: '–ü—è—Ç–Ω–∏—Å—Ç—ã–π', circles: true },
            { name: 'tabby', desc: '–ú—Ä–∞–º–æ—Ä–Ω—ã–π', swirls: true }
        ];
        const names = ['–ú—É—Ä–∑–∏–∫', '–ü—É—à–∏—Å—Ç–∏–∫', '–®—Ä—ë–¥–∏–Ω–≥–µ—Ä', '–ë—É—Å—è', '–ö–µ–∫—Å', '–ó–≤—ë–∑–¥–æ—á–∫–∞', '–¢–∏—à–∞', '–ù—è—à–∞', '–§–∏—Ñ–∏', '–õ–∞–ø–∫–∞'];

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
        let clicks = parseInt(localStorage.getItem('catClicks')) || 0;
        let coins = parseInt(localStorage.getItem('catCoins')) || 0;
        let potions = parseInt(localStorage.getItem('catPotions')) || 0;
        let inventory = JSON.parse(localStorage.getItem('catInventory')) || [];

        const cat = document.getElementById('cat');
        const counter = document.getElementById('counter');
        const coinsEl = document.getElementById('coins');
        const potionsEl = document.getElementById('potions');
        const bagContent = document.getElementById('bag-content');
        const buyPotionBtn = document.getElementById('buy-potion');
        const breedBtn = document.getElementById('breed-btn');

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SVG –¥–ª—è –∫–æ—Ç–∏–∫–∞
        function generateCatSVG(catData) {
            const base = catBases.find(b => b.type === catData.type);
            const pat = patterns.find(p => p.name === catData.pattern);
            let svg = `<defs>
                <pattern id="tex${Math.random()}" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse">
                    <rect width="10" height="10" fill="${base.baseColor}"/>
                    ${pat.name === 'striped' ? `<path d="${pat.path}" stroke="#333" stroke-width="1" opacity="0.5"/>` : ''}
                    ${pat.name === 'spotted' ? `<circle cx="2" cy="2" r="1" fill="#333" opacity="0.5"/><circle cx="8" cy="8" r="1.5" fill="#333" opacity="0.5"/>` : ''}
                    ${pat.name === 'tabby' ? `<circle cx="5" cy="5" r="3" fill="none" stroke="#333" stroke-width="0.5" opacity="0.3"/>` : ''}
                </pattern>
            </defs>
            <circle cx="50" cy="50" r="30" fill="url(#tex${Math.random()})" stroke="#333" stroke-width="2"/>
            <circle cx="35" cy="45" r="3" fill="black"/>
            <circle cx="65" cy="45" r="3" fill="black"/>
            <circle cx="50" cy="55" r="4" fill="pink"/>
            <path d="M45 60 Q50 65 55 60" stroke="black" stroke-width="2" fill="none"/>
            <path d="M30 30 L25 20 L35 25 Z" fill="${base.baseColor}" stroke="#333" stroke-width="2"/>
            <path d="M70 30 L75 20 L65 25 Z" fill="${base.baseColor}" stroke="#333" stroke-width="2"/>
            <path d="M80 70 Q90 80 85 90" stroke="${base.baseColor}" stroke-width="4" fill="none" stroke-linecap="round"/>`;
            return svg;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            counter.textContent = `–ö–ª–∏–∫–æ–≤: ${clicks}`;
            coinsEl.textContent = `–ö–æ—Ç–æ-–º–æ–Ω–µ—Ç—ã: ${coins}`;
            potionsEl.textContent = `–ó–µ–ª—å—è: ${potions}`;
            buyPotionBtn.disabled = coins < 50;
            breedBtn.disabled = inventory.length < 2 || potions < 1;

            if (inventory.length === 0) {
                bagContent.innerHTML = '<div class="empty-bag">–°—É–º–∫–∞ –ø—É—Å—Ç–∞, –∫–ª–∏–∫–∞–π –¥–∞–ª—å—à–µ!</div>';
            } else {
                bagContent.innerHTML = inventory.map((cat, index) => `
                    <div class="cat-item">
                        <svg class="cat-svg" viewBox="0 0 100 100">${generateCatSVG(cat)}</svg>
                        <span>${cat.name} (${cat.type}, ${patterns.find(p => p.name === cat.pattern).desc}) ‚Äî ${cat.price} –º–æ–Ω–µ—Ç</span>
                        <button class="sell-btn" onclick="sellCat(${index})">–ü—Ä–æ–¥–∞—Ç—å</button>
                    </div>
                `).join('');
            }
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            localStorage.setItem('catClicks', clicks);
            localStorage.setItem('catCoins', coins);
            localStorage.setItem('catPotions', potions);
            localStorage.setItem('catInventory', JSON.stringify(inventory));

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∫–æ—Ç–∏–∫–∞ (–ø–µ—Ä–≤—ã–π –∏–∑ —Ç–∏–ø–æ–≤, –∏–ª–∏ —Ä–∞–Ω–¥–æ–º)
            const currentCat = { type: catBases[Math.floor(Math.random() * catBases.length)].type, pattern: patterns[Math.floor(Math.random() * patterns.length)].name };
            cat.innerHTML = generateCatSVG(currentCat);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –∫–æ—Ç–∏–∫–∞
        function generateCat(parent1 = null, parent2 = null) {
            let type, pattern, price;
            if (parent1 && parent2) {
                // –°–∫—Ä–µ—â–∏–≤–∞–Ω–∏–µ: –º–∏–∫—Å
                type = Math.random() > 0.5 ? parent1.type : parent2.type;
                pattern = Math.random() > 0.5 ? parent1.pattern : parent2.pattern;
                price = Math.floor((parent1.price + parent2.price) / 2 + Math.random() * 20 - 10); // –°—Ä–µ–¥–Ω–µ–µ ¬±10
            } else {
                // –û–±—ã—á–Ω—ã–π –¥—Ä–æ–ø
                const base = catBases[Math.floor(Math.random() * catBases.length)];
                type = base.type;
                pattern = patterns[Math.floor(Math.random() * patterns.length)].name;
                const basePrice = Math.random() * 40 + 10;
                price = Math.floor(basePrice);
            }
            const name = names[Math.floor(Math.random() * names.length)];
            return { name, type, pattern, price: Math.max(5, price) };
        }

        // –ü—Ä–æ–¥–∞—Ç—å –∫–æ—Ç–∏–∫–∞
        window.sellCat = function(index) {
            const cat = inventory.splice(index, 1)[0];
            coins += cat.price;
            updateUI();
            alertOrShow(`–ü—Ä–æ–¥–∞–ª ${cat.name} –∑–∞ ${cat.price} –º–æ–Ω–µ—Ç! üí∞`);
        };

        // –ö—É–ø–∏—Ç—å –∑–µ–ª—å–µ
        buyPotionBtn.addEventListener('click', () => {
            if (coins >= 50) {
                coins -= 50;
                potions++;
                updateUI();
                alertOrShow('–ó–µ–ª—å–µ –∫—É–ø–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å —Å–∫—Ä–µ—â–∏–≤–∞–π üòà');
            }
        });

        // –°–∫—Ä–µ—â–∏–≤–∞–Ω–∏–µ
        breedBtn.addEventListener('click', () => {
            if (inventory.length >= 2 && potions >= 1) {
                const idx1 = Math.floor(Math.random() * inventory.length);
                const idx2 = (idx1 + 1 + Math.floor(Math.random() * (inventory.length - 1))) % inventory.length;
                const parent1 = inventory[idx1];
                const parent2 = inventory[idx2];
                const newCat = generateCat(parent1, parent2);
                inventory.push(newCat);
                potions--;
                // –£–¥–∞–ª—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª–µ–π? –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –≥–µ–Ω–µ—Ä–∏–º –Ω–æ–≤–æ–≥–æ, –∫–∞–∫ –≤ —Ñ–µ—Ä–º–µ
                updateUI();
                alertOrShow(`–°–∫—Ä–µ—Å—Ç–∏–ª ${parent1.name} –∏ ${parent2.name}! –ü–æ–ª—É—á–∏–ª ${newCat.name} (${newCat.type}, ${patterns.find(p => p.name === newCat.pattern).desc}) –∑–∞ ${newCat.price} –º–æ–Ω–µ—Ç ‚ú®`);
            }
        });

        function alertOrShow(msg) {
            if (Telegram.WebApp) {
                Telegram.WebApp.showAlert(msg);
            } else {
                alert(msg);
            }
        }

        // –ö–ª–∏–∫ –ø–æ –∫–æ—Ç–∏–∫—É
        cat.addEventListener('click', () => {
            clicks++;
            updateUI();

            // –ê–Ω–∏–º–∞—Ü–∏—è
            cat.style.transform = 'scale(1.2)';
            setTimeout(() => {
                cat.style.transform = 'scale(1)';
            }, 150);

            // –ö–∞–∂–¥—ã–µ 50 –∫–ª–∏–∫–æ–≤ ‚Äî –Ω–æ–≤—ã–π –∫–æ—Ç–∏–∫!
            if (clicks % 50 === 0) {
                const newCat = generateCat();
                inventory.push(newCat);
                updateUI();
                alertOrShow(`${newCat.name} (${newCat.type}, ${patterns.find(p => p.name === newCat.pattern).desc}) —É–ø–∞–ª –≤ —Å—É–º–∫—É! –¶–µ–Ω–∞: ${newCat.price} –º–æ–Ω–µ—Ç üòª`);
            }

            // –ë–æ–Ω—É—Å –∞–ª–µ—Ä—Ç –∫–∞–∂–¥—ã–µ 10
            if (clicks % 10 === 0 && clicks % 50 !== 0) {
                alertOrShow(`–í–∞—É, ${clicks} –∫–ª–∏–∫–æ–≤! –ö–æ—Ç–∏–∫ –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ üêæ`);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateUI();
    </script>
</body>
</html>
